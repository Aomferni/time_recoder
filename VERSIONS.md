## 版本更新记录

### v2.7.83 (2025-10-19)
- 修复duration字段计算问题
  - 修复更新记录时duration字段未正确重新计算的问题
  - 确保segments更新时总是重新计算所有时间字段
  - 更新PRD和structure文档，明确时间字段更新机制

### v2.7.82 (2025-10-19)
- 修复duration字段同步问题
  - 修复后端和前端duration字段处理逻辑，确保值为0时也能正确同步
  - 更新PRD和structure文档，明确同步机制细节

### v2.7.81 (2025-10-19)
- 增加飞书同步调试信息和确保duration同步
  - 在飞书同步时增加打印活动名称和duration的调试信息
  - 确保后端和前端都正确处理duration字段的计算和传递
  - 更新PRD和structure文档，明确同步机制细节

### v2.7.80 (2025-10-19)
- 清理活动选择弹窗无效CSS代码
  - 清理activity-selection-optimized.css中重复的按钮样式定义
  - 确保代码简洁性和一致性
  - 删除修改后不再需要的无效代码，避免给后续编码造成歧义

### v2.7.79 (2025-10-19)
- 修复飞书配置页面【自动同步至飞书】开关有效性问题
  - 修复飞书配置页面【自动同步至飞书】开关关闭后仍然执行整点同步的问题
  - 确保开关状态能正确控制自动同步行为
  - 更新PRD和structure文档，强调开关的有效性

### v2.7.78 (2025-10-19)
- 优化飞书同步机制
  - 移除同步所有记录到飞书的逻辑
  - 在每次保存单独活动详情和停止一次活动计时时，单独同步该记录到飞书多维表格
  - 更新PRD和structure文档，澄清功能变更

### v2.7.77 (2025-10-19)
- 优化活动选择弹窗按钮颜色显示
  - 优化活动选择弹窗按钮颜色显示与活动类别颜色一致
  - 确保按钮颜色正确反映活动分类
  - 更新PRD和structure文档，明确视觉优化细节

### v2.7.76 (2025-10-19)
- 修复活动选择弹窗按钮颜色显示
  - 创建专门的CSS文件解决按钮颜色显示问题
  - 使用高优先级选择器确保样式正确应用
  - 直接使用十六进制颜色值确保颜色正确显示

### v2.7.75 (2025-10-19)
- 修复活动选择弹窗按钮颜色重复定义冲突
  - 解决CSS重复定义冲突问题，确保按钮显示正确的背景和文字颜色
  - 调整CSS选择器特异性，提高样式优先级
  - 优化基础样式与具体场景样式的分离

### v2.7.74 (2025-10-19)
- 修复活动选择弹窗按钮样式冲突
  - 解决CSS样式冲突问题，确保按钮显示正确的背景和文字颜色
  - 调整CSS优先级，确保活动选择弹窗样式正确应用
  - 移除可能导致冲突的全局样式设置

### v2.7.73 (2025-10-19)
- 修复活动选择弹窗按钮背景颜色
  - 为不同类别的按钮明确设置背景颜色
  - 确保所有类别按钮都显示正确的背景颜色
  - 统一处理按钮样式，提高视觉一致性

### v2.7.72 (2025-10-19)
- 修复日志歧义问题
  - 修改保存成功日志信息，明确表示只是本地保存而非同步完成
  - 避免用户误解同步状态

### v2.7.71 (2025-10-19)
- 统一颜色定义管理
  - 在PRD和structure文档中澄清颜色定义的统一管理策略
  - 建立清晰的颜色使用规范，避免硬编码和重复定义
  - 确保所有颜色定义都基于activity_categories.json文件

### v2.7.70 (2025-10-19)
- 修复收起时飞书同步问题
  - 创建专门的收起时同步函数，不受自动同步开关影响
  - 修改收起按钮点击事件，调用新的同步函数
  - 更新PRD和structure文档，明确同步机制差异

### v22.7.69 (2025-10-19)
- 修复活动选择弹窗按钮颜色问题
  - 为不同类别的按钮设置合适的文字颜色
  - 确保深色背景按钮使用白色文字，浅色背景按钮使用深色文字
  - 提高按钮文字与背景的对比度，增强可读性

### v2.7.68 (2025-10-19)
- 修复选择活动页按钮颜色问题
  - 修改按钮默认文字颜色，确保在浅色背景上有足够对比度
  - 为特定类别的按钮设置合适的文字颜色

### v2.7.67 (2025-10-19)
- 修复飞书自动同步开关有效性
  - 修改savePlan函数，在保存成功后调用checkAndSyncToFeishu函数
  - 确保自动保存时也能正确检查飞书配置和自动同步开关状态

### v2.7.66 (2025-10-19)
- 澄清并修复飞书同步实现
  - 更新PRD和structure文档，明确说明activityCategory字段的同步和已有记录的更新机制
  - 确认后端实现已正确处理飞书同步的具体实现细节

### v2.7.65 (2025-10-19)
- 修复飞书自动同步开关有效性
  - 修改checkAndSyncToFeishu函数，增加对自动同步开关的检查
  - 只有在飞书已配置且自动同步开关启用的情况下才执行同步操作
  - 更新PRD和structure文档，强调自动同步开关的控制作用

### v2.7.64 (2025-10-19)
- 优化飞书同步机制
  - 移除同步所有记录到飞书的逻辑
  - 在每次保存单独活动详情和停止一次活动计时时，单独同步该记录到飞书多维表格
  - 更新PRD和structure文档，澄清功能变更

### v2.7.63 (2025-10-19)
- 修复【选择活动】弹窗按钮显示问题
  - 修复按钮白色背景和白色字体导致看不清的问题
  - 重新设计弹窗布局，按类别列排列活动按钮
  - 调整按钮样式，增大点击区域，提高可用性
  - 优化移动端显示效果

### v2.7.62 (2025-10-19)
- 优化【选择活动】弹窗布局
  - 按活动类别进行分区展示
  - 活动按钮显示为对应的活动类别颜色
  - 优化布局使其更加紧凑
  - 每行最多显示8个按钮

### v2.7.61 (2025-10-19)
- 澄清飞书字段映射关系
  - 更新PRD文档，明确importantThings、tryThings、score、scoreReason字段与飞书多维表格的映射关系
  - 更新structure文档，明确今日计划数据结构中各字段与飞书的对应关系
  - 确保从飞书导入功能能正确映射这些字段

### v2.7.60 (2025-10-19)
- 修复飞书导入今日计划功能
  - 修复飞书配置页面的【从飞书导入】功能，确保能正确导入plans.json文件
  - 完善从飞书多维表格获取今日计划数据并保存到本地的实现
  - 增强错误处理和日志记录
  - 更新PRD和structure文档，记录功能修复变更

### v2.7.59 (2025-10-19)
- 合并飞书同步计划接口
  - 合并 `init_sync_plans_from_feishu` 和 `sync_plans_from_feishu` 函数，避免代码重复
  - 统一飞书同步今日计划的API端点为 `/api/feishu/sync-plans`
  - 更新前端调用以使用统一的API端点
  - 更新PRD和structure文档，记录接口合并变更

### v2.7.58 (2025-10-19)
- 修复浏览器自动填充导致的历史记录页搜索问题
  - 添加对浏览器自动生成的客户端ID的检测和清除逻辑
  - 确保搜索功能不受浏览器自动填充影响
  - 完善历史记录页面的数据加载和显示逻辑

### v2.7.57 (2025-10-19)
- 深入修复历史记录页操作后记录不显示及分页问题
  - 完善历史记录页面的分页逻辑，确保删除记录后能正确处理页面跳转
  - 修复记录详情保存和删除操作后的刷新逻辑，确保历史记录页面能正确维护分页状态
  - 增强错误处理机制，确保在数据加载失败时能给出明确的错误提示
  - 优化跨页面数据同步机制，确保所有页面数据一致性
  - 添加详细调试信息，便于问题追踪和解决
  - 完善边界条件处理，确保各种情况都能正确处理

### v2.7.56 (2025-10-19)
- 修复历史记录页操作后记录不显示及分页问题
  - 完善历史记录页面的分页逻辑，确保删除记录后能正确处理页面跳转
  - 修复记录详情保存和删除操作后的刷新逻辑，确保历史记录页面能正确维护分页状态
  - 增强错误处理机制，确保在数据加载失败时能给出明确的错误提示
  - 优化跨页面数据同步机制，确保所有页面数据一致性

### v2.7.55 (2025-10-19)
- 修复历史记录页操作后记录不显示问题
  - 完善历史记录页面的刷新机制，确保在操作完成后正确重新加载数据
  - 修复跨页面通信中的问题，确保历史记录页面能正确接收和处理刷新信号
  - 增强错误处理机制，确保在数据加载失败时能给出明确的错误提示
  - 优化删除记录后的页面刷新逻辑

### v2.7.54 (2025-10-19)
- 初始化时同步飞书今日计划
  - 实现初始化时验证飞书链接有效性
  - 实现从飞书完整同步今日计划到 plans.json
  - 实现从飞书完整同步活动记录到 records.json
  - 更新PRD和structure文档，明确初始化配置功能细节

### v2.7.53 (2025-10-19)
- 修复情绪选择重复处理问题
  - 添加阻止事件冒泡和默认行为的代码
  - 完善事件重复处理的判断逻辑
  - 确保每次点击只处理一次事件

### v2.7.52 (2025-10-19)
- 澄清情绪选择术语
  - 更新PRD文档，明确情绪支持多选
  - 更新structure文档，明确情绪多选交互优化
  - 修改代码中的函数名称和日志信息，使用更准确的表述

### v2.7.51 (2025-10-19)
- 修复活动类别"其他"问题
  - 修改后端逻辑，移除返回"其他"类别的宽松匹配逻辑
  - 修改前端活动详情页，动态加载所有活动类别到下拉框
  - 增强数据验证，确保activityCategory字段不为空
  - 更新PRD文档，明确活动类别规范

### v2.7.50 (2025-10-19)
- 修复情绪选择时灵时不灵问题
  - 添加事件去重机制，防止同一点击事件被重复处理
  - 完善事件目标元素查找逻辑，支持多种点击情况
  - 优化处理标记移除时机，提升交互流畅性

### v2.7.49 (2025-10-19)
- 修复今日计划活动类型显示"其他"类别问题
  - 过滤掉今日计划活动类型集合中的"其他"类别
  - 确保只显示明确的活动类别
  - 更新PRD和structure文档，明确活动墙显示规范

### v2.7.48 (2025-10-19)
- 新增项目初始化配置功能
  - 在项目首次启动时要求用户配置飞书集成
  - 从飞书多维表格同步活动记录和今日计划数据
  - 添加初始化配置页面和相关API端点
  - 更新PRD和structure文档，添加初始化配置功能说明

### v2.7.47 (2025-10-19)
- 修复情绪选择功能显示问题
  - 修复活动详情页点选情绪时√标记无法正确显示的问题
  - 优化checkmark元素的显示逻辑，确保选中状态正确可视化
  - 增强情绪选择事件处理机制，提高交互稳定性
  - 完善调试日志，便于问题诊断和修复

### v2.7.46 (2025-10-19)
- 修复今日计划自动保存时间
  - 修改PRD文档，明确今日计划自动保存时间更新为北京时间整点
  - 修改structure文档，添加自动保存时间更新为整点的说明
  - 修改前端JavaScript代码，重新实现自动保存定时器逻辑，使其在整点时间触发
  - 确保自动保存时间显示的一致性和可预测性

### v2.7.45 (2025-10-19)
- 修复历史记录页面数据刷新问题
  - 修改PRD文档，明确在活动详情页保存或删除记录后需要自动刷新当前页面及其他相关页面的数据
  - 修改structure文档，添加跨页面数据刷新机制说明
  - 优化历史记录页面的删除操作，确保操作完成后正确刷新页面数据
  - 增强记录详情模块的数据刷新功能，确保在历史记录页面也能正确触发数据刷新

### v2.7.44 (2025-10-19)
- 修复编辑历史日期计划跳转问题
  - 修改PRD文档和structure文档，明确自动保存和同步功能应针对当前编辑的日期
  - 修改后端API代码，修复飞书同步接口中的计划加载逻辑
  - 确保用户编辑历史日期计划时不会自动跳转到当前日期

### v2.7.43 (2025-10-19)
- 修复新一天无活动记录报错
  - 修改PRD文档和structure文档，澄清新一天没有活动记录是正常情况
  - 修改前端JavaScript代码，添加数组检查防止forEach调用错误
  - 确保新一天开始时页面正常显示空状态

### v2.7.42 (2025-10-19)
- 今日计划使用北京时间显示
  - 修改PRD文档和structure文档，明确今日计划自动展示北京时间的日期
  - 修改后端代码确保加载和创建今日计划时使用北京时间
  - 修改前端JavaScript代码确保日期选择器和日期显示使用北京时间

### v2.7.41 (2025-10-19)
- 统一今日计划存储方式
  - 修改PRD文档和structure文档，明确所有计划数据统一存储在plans.json文件中
  - 修改后端代码实现统一存储，不再创建分散的plan_xxxx.json文件
  - 更新DailyPlanUtils类，所有计划数据统一管理到plans.json索引文件中

### v2.7.40 (2025-10-19)
- 澄清今日计划日期选择功能
  - 更新PRD文档，明确说明自动更新字段会根据用户选择的日期进行更新
  - 更新structure文档，明确说明后端统计数据更新逻辑会根据用户选择的日期加载对应记录
  - 验证代码实现确认功能正确性

### v2.7.39 (2025-10-19)
- 今日计划支持日期选择功能
  - 修改PRD文档和structure文档，更新今日计划功能描述
  - 修改后端load_daily_plan函数，支持加载指定日期的计划
  - 更新前端JavaScript代码，添加日期选择器功能
  - 更新CSS样式，美化日期选择器界面

### v2.7.38 (2025-10-19)
- 修复飞书同步日期不一致问题
  - 修复因时区差异导致飞书同步日期错误的问题
  - 确保飞书同步使用正确的日期
  - 完善日期一致性检查机制

### v2.7.37 (2025-10-19)
- 优化今日计划管理功能
  - 修复load_daily_plan函数中的重复代码问题
  - 确保每次请求都返回当日计划
  - 完善计划索引文件管理，包含飞书记录ID字段
  - 更新PRD和structure文档，确保数据结构描述准确

### v2.7.36 (2025-10-19)
- 修复情绪选择点击间隔限制问题
  - 移除300ms的点击间隔限制，允许用户快速连续选择情绪
  - 保留processing类处理标记机制，防止真正的重复点击
  - 优化处理标记移除时机，提升用户体验

### v2.7.35 (2025-10-19)
- 修复活动墙类别匹配逻辑问题
  - 活动墙直接使用记录中的activityCategory字段，而不是通过活动名称匹配
  - 更新PRD和structure文档，强调应直接使用activityCategory字段
  - 确保活动墙准确显示用户设置的活动类别

### v2.7.34 (2025-10-19)
- 修复今日计划日期不符和计划文件管理问题
  - 当请求的今日计划日期与实际日期不符时，自动创建新的当日计划
  - 所有今日计划记录统一管理到plans.json索引文件中
  - 更新PRD和structure文档，添加计划文件管理说明

### v2.7.33 (2025-10-18)
- 修复活动墙显示"其他"类别问题
  - 过滤掉未匹配到已配置类别的活动记录
  - 确保活动墙只显示明确定义的活动类别

### v2.7.32 (2025-10-18)
- 修复情绪选中功能显示问题
  - 修复活动详情页点选情绪时√标记无法正确显示的问题
  - 优化checkmark元素的显示逻辑，确保选中状态正确可视化

### v2.7.31 (2025-10-18)
- 增加系统日志功能
  - 实现前端和后端日志记录
  - 添加日志查看页面
  - 支持日志筛选、导出和自动清理

### v2.7.30 (2025-10-18)
- 记录活动类型墙的渲染日志，分析颜色显示问题
  - 添加活动类型墙渲染日志
  - 分析【工作输出】类别颜色显示问题

### v2.7.29 (2025-10-18)
- 优化情绪选择交互防止重复点击误判
  - 改进情绪选择的重复点击判断机制
  - 优化处理标记移除时机，提升用户体验

### v2.7.28 (2025-10-18)
- 修复活动类型墙小方块颜色显示问题
  - 修复活动类型墙小方块颜色映射错误
  - 确保各类别活动显示正确的颜色

### v2.7.27 (2025-10-18)
- 修复活动详情页情绪选择和保存问题
  - 添加详细的情绪选择和保存过程日志
  - 增强情绪选择状态跟踪
  - 完善保存过程验证

### v2.7.26 (2025-10-18)
- 情绪与活动墙小方块尺寸优化
  - 增大情绪与活动墙小方块尺寸，从25px增加到35px
  - 调整小方块文本尺寸，提高可读性
  - 优化容器间距和内边距，改善整体布局

### v2.7.25 (2025-10-18)
- 活动类型墙小方块颜色和透明度优化
  - 活动类型墙的小方块按照活动类型展示对应的颜色
  - 调整透明度规则：时长达到1小时透明度为100%，0秒时透明度为50%
  - 统一情绪墙和活动墙的透明度计算规则

### v2.7.24 (2025-10-18)
- 情绪图例和活动类型图例显示对应颜色
  - 修复情绪图例和活动类型图例颜色显示问题
  - 统一图例颜色显示，使其与情绪墙和活动墙保持一致
  - 优化图例样式，提高可读性

### v2.7.23 (2025-10-18)
- 情绪墙和活动墙显示所有日期
  - 情绪墙和活动墙显示最近7天的所有日期
  - 即使某一天没有记录也会显示空行
  - 添加"无记录"提示信息
  - 保持日期显示的完整性和一致性

### v2.7.22 (2025-10-18)
- 活动墙显示实际活动类别
  - 活动墙的小方块上显示每个记录实际的`activityCategory`字段值
  - 而不是显示类别的名称
  - 提高了活动墙信息的准确性和实用性

### v2.7.21 (2025-10-18)
- 情绪墙和活动墙小方块显示对应文本
  - 在情绪墙的小方块上显示对应的情绪文本
  - 在活动墙的小方块上显示对应的活动类型文本
  - 优化文本显示样式，确保在小方块上清晰可见

### v2.7.20 (2025-10-18)
- 优化情绪墙和活动墙显示效果
  - 近一周的日期从近到远从上至下排列
  - 每个活动记录都有一个小方块显示
  - 方块根据时长设置透明度，时长越短透明度越高
  - 鼠标移动到小方块上方时显示活动名称和对应的时长
  - 点击小方块可以打开活动详情的浮窗
  - 优化整体视觉效果和交互体验

### v2.7.19 (2025-10-18)
- 修复情绪与活动墙显示为空的问题
  - 修复情绪墙和活动墙页面的CSS文件引用错误
  - 优化情绪墙和活动墙的渲染逻辑
  - 确保数据能正确显示在页面上

### v2.7.18 (2025-10-18)
- 修复情绪与活动墙显示为空的问题
  - 修复情绪墙和活动墙页面的API端点调用错误
  - 优化情绪墙和活动墙的渲染逻辑
  - 添加空数据提示显示
  - 修复关键词词云显示问题

### v2.7.17 (2025-10-18)
- 优化当前活动信息显示
  - 当前活动信息始终居中显示
  - 字体大小调整为30px
- 优化【选择活动】浮窗布局
  - 恢复活动类别分区显示
  - 每行最多展示8个按钮
- 优化【活动详情】浮窗页情绪记录功能
  - 情绪按钮前添加对应emoji
  - 优化情绪按钮监听逻辑，提高稳定性

### v2.7.16 (2025-10-18)
- 优化快速情绪记录功能
  - 移除"已记录情绪: 情绪名称"提示信息
  - 在已选中的情绪按钮右上角显示"√"标记
  - 支持点击已选中情绪按钮取消选择
  - 优化选中状态的视觉效果

### v2.7.15 (2025-10-18)
- 优化【选择活动】浮窗布局
  - 不同类别的活动按钮放在同一行显示
  - 每行最多展示8个按钮
  - 优化手机端适配效果

### v2.7.14 (2025-10-18)
- 优化快速情绪记录区域显示
  - 快速情绪记录按钮只显示表情图标
  - 鼠标悬停时显示情绪文字
  - 提升界面简洁性和用户体验

### v2.7.13 (2025-10-18)
- 实现【今日计划已自动保存】时同步计时记录到飞书功能
  - 在今日计划自动保存时，同时导出计时记录到飞书多维表格
  - 使用现有飞书同步逻辑，确保数据一致性
  - 优化同步流程，先同步计划数据再同步记录数据

### v2.7.12 (2025-10-18)
- 优化活动选择弹窗布局
  - 【选择活动】浮窗占据整体的3/5宽度
  - 优化弹窗布局使其更加紧凑
  - 调整内边距、外边距和字体大小

### v2.7.11 (2025-10-18)
- 修复【给今天打个分】字段同步至飞书问题
  - 增加对"给今天打个分"中文字段名的匹配支持
  - 确保评分字段能够正确同步至飞书多维表格
  - 同时支持评分原因字段的同步

### v2.7.10 (2025-10-18)
- 修复继续按钮后显示快速情绪记录区域问题
  - 点击【继续】按钮恢复历史活动后，显示快速记录情绪内容区域
  - 在记录详情页面保存记录后，正确显示快速情绪记录区域
  - 确保用户可在继续计时后立即记录情绪

### v2.7.9 (2025-10-18)
- 修复快速记录情绪选项与emotion字段一致性问题
  - 更新快速情绪记录按钮，包含所有定义的情绪选项
  - 确保情绪按钮文本与emotion字段定义完全匹配
  - 添加emoji图标提高用户体验
  - 保持与记录详情页面和情绪墙页面的情绪选项一致性

### v2.7.8 (2025-10-18)
- 实现计时器后台运行功能
  - 计时器在页面刷新或切换时继续运行
  - 使用localStorage持久化存储计时器状态
  - 定期保存计时器状态防止意外丢失
  - 支持页面重新可见时恢复计时器状态

### v2.7.7 (2025-10-18)
- 修复活动详情页保存后刷新所有页面的问题
  - 保存活动详情后同步刷新所有页面的数据显示
  - 使用localStorage实现跨页面数据刷新通知
  - 确保各页面数据一致性

### v2.7.6 (2025-10-18)
- 修复选择新活动后创建新记录的问题
  - 选择新活动后清除当前记录ID
  - 确保创建新记录而不是修改现有记录

### v2.7.5 (2025-10-18)
- 调整活动详情弹窗宽度为页面的3/5

### v2.7.4 (2025-10-18)
- 优化快速情绪记录功能
  - 点击【继续】按钮后展示快速记录情绪内容
  - 为情绪按钮添加emoji图标
  - 确保情绪记录与活动记录字段保持一致

### v2.7.3 (2025-10-18)
- 修改计时器部分为全宽显示

### v2.7.2 (2025-10-18)
- 修改【今日统计】部分为全宽显示

### v2.7.1 (2025-10-18)
- 修复点击【继续】按钮时计时器未更新为对应类别颜色的问题

### v2.7.0 (2025-10-18)
- 优化【选择活动】弹窗布局，按活动类别分组显示
- 在专注计时器下方增加快速情绪记录区域
- 修复【今日计划】统计数据在展开态与收起态样式不一致的问题

### v2.6.0 (2025-10-17)
- 合并计时器区域和开始按钮，支持点击开始/停止计时
- 合并【请选择活动】和选择活动墙，支持单击弹窗选择、双击编辑活动名称
- 优化活动选择弹窗布局，按类别分组显示
- 修复计时器点击结束计时功能
- 修复未设置活动标题时点击计时器的提醒功能

### v2.5.0 (2025-10-16)
- 修改【今日计划已自动保存】时间间隔为1小时
- 移除独立的【同步到飞书】按钮，集成到自动保存和收起功能中
- 修复今日计划的多维表格【今日专注时长】同步问题
- 在今日计划折叠态展示【专注时长、创作时长、活动次数】统计数据

### v2.4.0 (2025-10-15)
- 增加飞书多维表格同步功能
- 优化今日计划模块的自动保存机制
- 修复计时器模块的事件处理逻辑

### v2.3.0 (2025-10-14)
- 重构前端代码结构，模块化管理
- 优化计时器UI交互体验
- 增加活动分类管理功能
- 修复数据统计逻辑

### v2.2.0 (2025-10-13)
- 增加情绪与活动墙功能
- 优化记录详情展示
- 修复时间计算逻辑

### v2.1.0 (2025-10-12)
- 重构项目结构，分离前端和后端
- 增加数据库支持
- 优化用户界面设计

### v2.0.0 (2025-10-11)
- 项目重构，采用Flask后端
- 增加数据库支持
- 优化用户界面设计

### v1.0.0 (2025-10-10)
- 初始版本发布
- 基础时间记录功能
- 简单的UI界面