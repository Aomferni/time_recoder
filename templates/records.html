{% extends "base.html" %}

{% block title %}历史记录 - 时间追踪器{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/user-section.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/feishu-config.css') }}">
{% endblock %}

{% block content %}
<h1>历史记录</h1>

<div class="records-header">
    <div class="navigation">
        <a href="/" class="nav-link">返回首页</a>
        <a href="/mood-wall" class="nav-link">情绪与活动墙</a>
        <a href="/project-description" class="nav-link">项目说明</a>
    </div>
</div>

<div class="records-controls">
    <div class="filter-section">
        <div class="filter-row">
            <div class="filter-group">
                <label for="dateFrom">开始日期:</label>
                <input type="date" id="dateFrom">
            </div>
            <div class="filter-group">
                <label for="dateTo">结束日期:</label>
                <input type="date" id="dateTo">
            </div>
            <div class="filter-group">
                <label for="activityFilter">活动类型:</label>
                <select id="activityFilter">
                    <option value="">全部活动</option>
                    <!-- 活动选项将通过JavaScript动态填充 -->
                </select>
            </div>
            <div class="filter-group">
                <label for="emotionFilter">情绪:</label>
                <select id="emotionFilter">
                    <option value="">全部情绪</option>
                    <option value="开心">开心</option>
                    <option value="专注">专注</option>
                    <option value="疲惫">疲惫</option>
                    <option value="焦虑">焦虑</option>
                    <option value="兴奋">兴奋</option>
                    <option value="平静">平静</option>
                    <option value="沮丧">沮丧</option>
                    <option value="满足">满足</option>
                    <option value="无聊">无聊</option>
                </select>
            </div>
        </div>
        <div class="filter-row">
            <div class="filter-group">
                <label for="searchInput">搜索:</label>
                <input type="text" id="searchInput" placeholder="活动名称或备注信息">
            </div>
            <div class="filter-actions">
                <button class="control-btn search-btn" onclick="timeRecorderRecords.applyFilters()">搜索</button>
                <button class="control-btn reset-btn" onclick="timeRecorderRecords.resetFilters()">重置</button>
                <button class="control-btn export-btn" onclick="timeRecorderRecords.exportRecords()">导出记录</button>
                <!-- 导入记录按钮 -->
                <input type="file" id="recordFileInput" accept=".json" class="file-input" style="display: none;">
                <button class="control-btn import-btn" id="importRecordBtn">导入记录</button>
                <!-- 飞书配置按钮 -->
                <button class="control-btn feishu-config-btn" onclick="timeRecorderRecords.showFeishuConfig()">飞书配置</button>
                <!-- 导出到飞书按钮 -->
                <button class="control-btn feishu-import-btn" onclick="timeRecorderRecords.importRecordsToFeishu()">导出至飞书</button>
                <!-- 从飞书同步按钮 -->
                <button class="control-btn feishu-sync-btn" onclick="timeRecorderRecords.syncRecordsFromFeishu()">从飞书同步</button>
                <div id="importStatus" class="import-status"></div>
            </div>
        </div>
    </div>
</div>

<!-- 飞书配置模态框 -->
<div id="feishuConfigModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="timeRecorderRecords.closeFeishuConfigModal()">&times;</span>
        <h2>飞书配置</h2>
        <div class="detail-form">
            <div class="highlight-field">
                <label for="feishuAppId">App ID:</label>
                <input type="text" id="feishuAppId" placeholder="请输入飞书应用的App ID">
            </div>
            <div class="highlight-field">
                <label for="feishuAppSecret">App Secret:</label>
                <input type="password" id="feishuAppSecret" placeholder="请输入飞书应用的App Secret">
            </div>
            <div class="detail-actions">
                <button type="button" class="save-btn" onclick="timeRecorderRecords.saveFeishuConfig()">保存</button>
                <button type="button" class="cancel-btn" onclick="timeRecorderRecords.closeFeishuConfigModal()">取消</button>
            </div>
        </div>
    </div>
</div>

<!-- 活动详情浮窗 -->
<div id="recordDetailModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="TimeRecorderRecordDetail.closeRecordDetailModal()">&times;</span>
        <h2>活动详情</h2>
        <div id="recordDetailContent"></div>
    </div>
</div>

<div class="records-table-container">
    <table class="records-table">
        <thead>
            <tr>
                <th>日期</th>
                <th>活动名称</th>
                <th>开始时间</th>
                <th>专注时长</th>
                <th>备注信息</th>
                <th>情绪</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="recordsBody">
        </tbody>
    </table>
</div>

<div class="pagination" id="pagination">
    <!-- 分页控件将通过JavaScript动态生成 -->
</div>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ url_for('static', filename='js/modules/records.js') }}"></script>
{% endblock %}