{% extends "base.html" %}

{% block title %}项目说明 - 时间追踪器{% endblock %}

{% block head %}
<style>
    /* 隐藏页面内的导航链接，因为顶部导航栏已经提供了导航 */
    .project-description .navigation {
        display: none;
    }
    
    .project-description {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .page-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        color: white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .page-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }
    
    .page-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        margin-bottom: 30px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-left: 5px solid #2196F3;
    }
    
    .section:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .section.user-focused {
        border-left-color: #4CAF50;
    }
    
    .section.developer-focused {
        border-left-color: #FF9800;
    }
    
    .section.future-plans {
        border-left-color: #9C27B0;
    }
    
    .section.ai-coding {
        border-left-color: #9C27B0;
    }
    
    .section h2 {
        color: #333;
        border-bottom: 3px solid #2196F3;
        padding-bottom: 12px;
        margin-bottom: 25px;
        font-size: 1.8rem;
    }
    
    .section.user-focused h2 {
        border-bottom-color: #4CAF50;
    }
    
    .section.developer-focused h2 {
        border-bottom-color: #FF9800;
    }
    
    .section.future-plans h2 {
        border-bottom-color: #9C27B0;
    }
    
    .section.ai-coding h2 {
        border-bottom-color: #9C27B0;
    }
    
    .section h3 {
        color: #444;
        margin: 25px 0 20px 0;
        font-size: 1.4rem;
    }
    
    .section h4 {
        color: #555;
        margin: 20px 0 15px 0;
        font-size: 1.2rem;
    }
    
    .section p {
        line-height: 1.7;
        color: #555;
        margin-bottom: 15px;
    }
    
    .section ul {
        margin-bottom: 20px;
        padding-left: 25px;
    }
    
    .section li {
        margin-bottom: 10px;
        line-height: 1.6;
    }
    
    .tech-stack {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin: 25px 0;
        justify-content: center;
    }
    
    .tech-item {
        background: #f8f9fa;
        padding: 15px 20px;
        border-radius: 8px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        min-width: 150px;
        justify-content: center;
    }
    
    .tech-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .tech-item.backend { 
        background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
        border-left: 4px solid #2196F3;
    }
    
    .tech-item.frontend { 
        background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
        border-left: 4px solid #4CAF50;
    }
    
    .tech-item.database { 
        background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
        border-left: 4px solid #FF9800;
    }
    
    .data-mapping-table, .function-table {
        width: 100%;
        border-collapse: collapse;
        margin: 25px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border-radius: 8px;
        overflow: hidden;
    }
    
    .data-mapping-table th,
    .data-mapping-table td,
    .function-table th,
    .function-table td {
        border: 1px solid #e0e0e0;
        padding: 15px;
        text-align: left;
    }
    
    .data-mapping-table th,
    .function-table th {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f1 100%);
        font-weight: bold;
        color: #333;
    }
    
    .data-mapping-table tr:nth-child(even),
    .function-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    
    .data-mapping-table tr:hover,
    .function-table tr:hover {
        background-color: #f0f7ff;
    }
    
    .core-functions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        margin: 25px 0;
    }
    
    .function-card {
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 20px;
        background: #fafafa;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    
    .function-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        background: #fff;
    }
    
    .function-card h4 {
        color: #333;
        margin-bottom: 15px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
        font-size: 1.2rem;
    }
    
    .function-card ul {
        padding-left: 20px;
    }
    
    .function-card li {
        margin-bottom: 12px;
        line-height: 1.5;
    }
    
    .api-endpoints {
        background: #f8f8f8;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        overflow-x: auto;
        margin: 20px 0;
        border: 1px solid #eee;
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .roadmap {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin: 30px 0;
    }
    
    .phase {
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 25px;
        background: #fafafa;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    
    .phase:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        background: #fff;
    }
    
    .phase h4 {
        color: #333;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #eee;
        font-size: 1.3rem;
    }
    
    .phase.short-term h4 {
        border-bottom-color: #4CAF50;
        color: #2E7D32;
    }
    
    .phase.medium-term h4 {
        border-bottom-color: #FF9800;
        color: #EF6C00;
    }
    
    .phase.long-term h4 {
        border-bottom-color: #9C27B0;
        color: #7B1FA2;
    }
    
    .phase ul {
        padding-left: 25px;
    }
    
    .phase li {
        margin-bottom: 12px;
        line-height: 1.5;
        position: relative;
    }
    
    .phase li:before {
        content: "•";
        color: #2196F3;
        font-weight: bold;
        position: absolute;
        left: -20px;
    }
    
    .navigation {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .nav-link {
        display: inline-block;
        padding: 12px 25px;
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        color: white;
        text-decoration: none;
        border-radius: 6px;
        margin: 0 15px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        font-weight: 500;
        font-size: 1rem;
    }
    
    .nav-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(33, 150, 243, 0.4);
        background: linear-gradient(135deg, #1976D2 0%, #0D47A1 100%);
    }
    
    .nav-link.secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        box-shadow: 0 4px 10px rgba(108, 117, 125, 0.3);
    }
    
    .nav-link.secondary:hover {
        background: linear-gradient(135deg, #495057 0%, #212529 100%);
        box-shadow: 0 6px 15px rgba(108, 117, 125, 0.4);
    }
    
    .mermaid {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }
    
    .code-block {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        overflow-x: auto;
        margin: 20px 0;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        line-height: 1.5;
        white-space: pre;
    }
    
    .category-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin: 20px 0;
        justify-content: center;
    }
    
    .category-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .category-item.work-output { background-color: #E3F2FD; color: #0D47A1; }
    .category-item.brain-charge { background-color: #E8F5E9; color: #1B5E20; }
    .category-item.body-charge { background-color: #E8F5E9; color: #1B5E20; }
    .category-item.rest { background-color: #F3E5F5; color: #4A148C; }
    .category-item.create { background-color: #FFF3E0; color: #E65100; }
    .category-item.gap { background-color: #E0F7FA; color: #006064; }
    .category-item.entertainment { background-color: #EEEEEE; color: #212121; }
    
    @media (max-width: 768px) {
        .project-description {
            padding: 10px;
        }
        
        .page-header h1 {
            font-size: 2rem;
        }
        
        .section {
            padding: 20px;
        }
        
        .core-functions {
            grid-template-columns: 1fr;
        }
        
        .roadmap {
            grid-template-columns: 1fr;
        }
        
        .tech-stack {
            flex-direction: column;
            align-items: center;
        }
        
        .nav-link {
            display: block;
            margin: 10px auto;
            max-width: 200px;
        }
    }
</style>
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/conclusion.css') }}">
{% endblock %}

{% block content %}
<div class="project-description">
    <div class="page-header">
        <h1>时间追踪器项目说明 (V1.2.15)</h1>
        <p>一个基于Python Flask的时间追踪Web应用，帮助用户记录和管理日常活动时间</p>
    </div>
    
    <div class="section user-focused">
        <h2>项目价值与使用场景</h2>
        
        <h3>核心价值</h3>
        <p>时间追踪器是一个基于Web的时间追踪与管理工具，帮助用户记录、分析和优化日常活动时间分配，同时记录情绪状态和活动收获。通过精确到秒的时间追踪和多维度的数据可视化，用户可以更好地了解自己的时间使用习惯，从而做出更明智的时间管理决策。</p>
        
        <h3>目标用户群体</h3>
        <ul>
            <li><strong>知识工作者</strong> - 需要管理个人时间，提高工作效率</li>
            <li><strong>自我提升者</strong> - 希望量化自己时间投入，追踪成长轨迹</li>
            <li><strong>情绪管理者</strong> - 需要了解情绪与活动的关系，进行情绪调节</li>
            <li><strong>时间复盘者</strong> - 需要定期回顾和反思时间使用情况</li>
        </ul>
        
        <h3>典型使用场景</h3>
        <div class="core-functions">
            <div class="function-card">
                <h4>日常工作时间管理</h4>
                <p>通过精确记录工作活动时间，了解各项任务的时间消耗，优化工作流程，提高工作效率。</p>
                <ul>
                    <li>记录核心工作时间（梳理方案、开会、执行工作、复盘）</li>
                    <li>追踪专注时长和时间跨度</li>
                    <li>分析工作时间分布，找出效率瓶颈</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>个人成长追踪</h4>
                <p>通过记录学习和成长活动，量化个人投入，追踪成长轨迹，为自我提升提供数据支持。</p>
                <ul>
                    <li>记录学习时间（和智者对话、做调研）</li>
                    <li>追踪身体锻炼（健身、散步）</li>
                    <li>分析成长活动的时间投入趋势</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>情绪与活动关联分析</h4>
                <p>通过关联活动与情绪，了解不同活动对情绪的影响，优化活动安排，提升生活幸福感。</p>
                <ul>
                    <li>记录活动时的情绪状态</li>
                    <li>可视化情绪分布（情绪墙）</li>
                    <li>分析情绪与活动类型的关系</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="section user-focused">
        <h2>核心功能详解</h2>
        
        <h3>活动时间追踪</h3>
        <p>实时记录活动时间，支持开始、暂停、继续、停止操作，精确到秒的时间追踪，支持多段落专注记录。</p>
        <ul>
            <li><strong>精确计时</strong> - 实时显示计时器，精确到秒</li>
            <li><strong>段落管理</strong> - 支持暂停功能，每次暂停创建一个新的专注段落</li>
            <li><strong>智能计算</strong> - 自动计算所有段落的累计时长和时间跨度</li>
            <li><strong>便捷操作</strong> - 计时器区域本身可点击来开始/停止计时</li>
        </ul>
        
        <h3>今日计划管理</h3>
        <p>帮助用户规划和回顾每一天，支持自动保存和飞书同步，通过日期选择器可查看和编辑历史日期的计划。</p>
        <ul>
            <li><strong>计划制定</strong> - 记录重要的三件事、要尝试的三件事、其他事项等</li>
            <li><strong>自动追踪</strong> - 系统自动追踪执行情况，整理今日做过的活动和情绪</li>
            <li><strong>智能同步</strong> - 支持与飞书多维表格集成，实现数据自动同步</li>
            <li><strong>历史查看</strong> - 支持选择不同日期进行查看和更新</li>
        </ul>
        
        <h3>数据可视化分析</h3>
        <p>通过情绪墙、活动墙、关键词词云等多维度展示时间分配，帮助用户直观了解时间使用情况。</p>
        <ul>
            <li><strong>情绪墙</strong> - 可视化展示最近7天的情绪分布</li>
            <li><strong>活动墙</strong> - 可视化展示最近7天的活动类型分布</li>
            <li><strong>词云分析</strong> - 展示最近7天活动和备注中的高频关键词</li>
            <li><strong>统计信息</strong> - 首页展示今日时间统计信息</li>
        </ul>
    </div>
    
    <div class="section user-focused">
        <h2>具体的分类与数据映射关系</h2>
        
        <h3>活动分类体系</h3>
        <div class="category-legend">
            <div class="category-item work-output">工作输出</div>
            <div class="category-item brain-charge">大脑充电</div>
            <div class="category-item body-charge">身体充电</div>
            <div class="category-item rest">修养生息</div>
            <div class="category-item create">输出创作</div>
            <div class="category-item gap">暂停一下</div>
            <div class="category-item entertainment">纯属娱乐</div>
        </div>
        
        <table class="data-mapping-table">
            <thead>
                <tr>
                    <th>分类名称</th>
                    <th>颜色标识</th>
                    <th>包含活动示例</th>
                    <th>用途说明</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>工作输出</td>
                    <td><span class="category-item work-output">蓝色</span></td>
                    <td>梳理方案、开会、执行工作、复盘</td>
                    <td>记录核心工作时间</td>
                </tr>
                <tr>
                    <td>大脑充电</td>
                    <td><span class="category-item brain-charge">绿色</span></td>
                    <td>和智者对话、做调研</td>
                    <td>学习和思考时间</td>
                </tr>
                <tr>
                    <td>身体充电</td>
                    <td><span class="category-item body-charge">绿色</span></td>
                    <td>健身、散步</td>
                    <td>运动和身体锻炼</td>
                </tr>
                <tr>
                    <td>修养生息</td>
                    <td><span class="category-item rest">紫色</span></td>
                    <td>处理日常、进入工作状态、睡觉仪式</td>
                    <td>休息和准备时间</td>
                </tr>
                <tr>
                    <td>输出创作</td>
                    <td><span class="category-item create">橙色</span></td>
                    <td>创作/写作、玩玩具</td>
                    <td>创造性活动时间</td>
                </tr>
                <tr>
                    <td>暂停一下</td>
                    <td><span class="category-item gap">青色</span></td>
                    <td>交流心得、记录|反思|计划</td>
                    <td>短暂休息和反思</td>
                </tr>
                <tr>
                    <td>纯属娱乐</td>
                    <td><span class="category-item entertainment">灰色</span></td>
                    <td>刷手机</td>
                    <td>娱乐消遣时间</td>
                </tr>
            </tbody>
        </table>
        
        <h3>情绪分类体系</h3>
        <p>情绪按照四个象限进行分类，帮助用户更好地理解和记录自己的情绪状态：</p>
        <table class="data-mapping-table">
            <thead>
                <tr>
                    <th>象限</th>
                    <th>情绪类型</th>
                    <th>包含情绪</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>正向+专注</td>
                    <td>积极且专注的情绪</td>
                    <td>惊奇、兴奋、高兴、愉悦</td>
                </tr>
                <tr>
                    <td>正向+松弛</td>
                    <td>积极且放松的情绪</td>
                    <td>安逸、安心、满足、宁静、放松</td>
                </tr>
                <tr>
                    <td>负面+松弛</td>
                    <td>消极但放松的情绪</td>
                    <td>悲伤、伤心、沮丧、疲惫</td>
                </tr>
                <tr>
                    <td>负面+专注</td>
                    <td>消极且专注的情绪</td>
                    <td>惊恐、紧张、愤怒、苦恼</td>
                </tr>
            </tbody>
        </table>
        
        <h3>数据结构映射</h3>
        <h4>记录数据结构</h4>
        <div class="code-block">
{
  "id": "记录唯一标识符",
  "username": "用户名",
  "activity": "活动名称",
  "activityCategory": "活动类别",
  "date": "记录日期（北京时间，格式：YYYY/MM/DD）",
  "startTime": "开始时间（UTC时间格式，ISO 8601）",
  "endTime": "结束时间（UTC时间格式，ISO 8601）",
  "duration": "计时时长（毫秒）",
  "timeSpan": "时间跨度（毫秒）",
  "remark": "备注信息",
  "emotion": "情绪标签",
  "pauseCount": "暂停次数",
  "segments": [
    {
      "start": "段落开始时间（UTC时间格式，ISO 8601）",
      "end": "段落结束时间（UTC时间格式，ISO 8601）",
      "duration": "段落持续时间（毫秒，可选）"
    }
  ]
}
        </div>
        
        <h4>用户数据存储</h4>
        <ul>
            <li>每个用户的数据存储在独立的JSON文件中</li>
            <li>文件路径：<code>data/{username}/records_{username}.json</code></li>
            <li>支持用户数据迁移</li>
        </ul>
    </div>
    
    <div class="section developer-focused">
        <h2>技术架构与实现</h2>
        
        <h3>核心技术路线</h3>
        <div class="tech-stack">
            <div class="tech-item backend">Python 3.x</div>
            <div class="tech-item backend">Flask Web框架</div>
            <div class="tech-item database">JSON文件存储</div>
            <div class="tech-item frontend">HTML5</div>
            <div class="tech-item frontend">CSS3</div>
            <div class="tech-item frontend">JavaScript (ES6模块化)</div>
            <div class="tech-item">RESTful API设计</div>
            <div class="tech-item">MVC模式</div>
        </div>
        
        <h3>模块化设计思想</h3>
        <p>项目采用模块化设计，将前端JavaScript代码拆分为多个独立的模块，以提高代码的可维护性和可扩展性。CSS也按照功能和样式类型划分为多个独立的样式文件。</p>
        
        <h4>JavaScript模块化</h4>
        <div class="core-functions">
            <div class="function-card">
                <h4>配置模块 (config.js)</h4>
                <ul>
                    <li>管理全局状态变量</li>
                    <li>定义常量配置</li>
                    <li>提供状态更新函数</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>工具模块 (utils.js)</h4>
                <ul>
                    <li>时间格式化和计算函数</li>
                    <li>CSS类名映射函数</li>
                    <li>情绪颜色处理函数</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>API模块 (api.js)</h4>
                <ul>
                    <li>封装所有后端接口调用</li>
                    <li>统一处理HTTP请求和响应</li>
                    <li>提供数据加载和保存功能</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>UI模块 (ui.js)</h4>
                <ul>
                    <li>用户界面交互处理</li>
                    <li>活动按钮渲染和更新</li>
                    <li>记录表格显示和更新</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>计时器模块 (timer.js)</h4>
                <ul>
                    <li>计时器启动/停止逻辑</li>
                    <li>时间显示更新</li>
                    <li>记录创建和更新</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>记录详情模块 (recordDetail.js)</h4>
                <ul>
                    <li>记录详情显示和编辑</li>
                    <li>段落管理功能</li>
                    <li>情绪选择交互优化</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>今日计划模块 (dailyPlan.js)</h4>
                <ul>
                    <li>今日计划加载和保存</li>
                    <li>自动保存机制</li>
                    <li>飞书同步功能</li>
                </ul>
            </div>
        </div>
        
        <h4>CSS模块化</h4>
        <p>CSS代码按照功能和样式类型划分为28个独立的样式文件，便于维护和扩展。每个模块负责特定的样式功能，如活动按钮、计时器、详情模态框等。</p>
        
        <h3>核心函数说明</h3>
        
        <h4>后端核心函数 (app.py)</h4>
        <div class="core-functions">
            <div class="function-card">
                <h4>数据管理函数</h4>
                <ul>
                    <li><code>get_data_file_path(username)</code> - 获取用户数据文件路径</li>
                    <li><code>load_records_by_username(username)</code> - 加载指定用户记录</li>
                    <li><code>load_all_records(username)</code> - 加载所有用户记录</li>
                    <li><code>save_records(records, username)</code> - 保存记录到文件</li>
                    <li><code>migrate_user_records(old_username, new_username)</code> - 迁移用户记录</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>API接口函数</h4>
                <ul>
                    <li><code>set_username()</code> - 设置用户名并迁移记录</li>
                    <li><code>get_records()</code> - 获取今日记录</li>
                    <li><code>get_record(record_id)</code> - 获取单个记录详情</li>
                    <li><code>add_record()</code> - 添加新记录</li>
                    <li><code>update_record(record_id)</code> - 更新记录</li>
                    <li><code>delete_record(record_id)</code> - 删除记录</li>
                    <li><code>get_all_records()</code> - 获取所有记录</li>
                    <li><code>get_stats()</code> - 获取统计信息</li>
                    <li><code>get_mood_wall_data()</code> - 获取情绪墙数据</li>
                    <li><code>get_activity_wall_data()</code> - 获取活动墙数据</li>
                    <li><code>get_keyword_cloud_data()</code> - 获取关键词词云数据</li>
                    <li><code>load_daily_plan()</code> - 加载今日计划</li>
                    <li><code>save_daily_plan()</code> - 保存今日计划</li>
                    <li><code>sync_daily_plan_to_feishu()</code> - 同步今日计划到飞书</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>辅助函数</h4>
                <ul>
                    <li><code>get_activity_category(activity)</code> - 根据活动名称获取类别</li>
                    <li><code>calculate_time_span(startTime, endTime)</code> - 计算时间跨度</li>
                </ul>
            </div>
        </div>
        
        <h4>前端核心模块</h4>
        <div class="core-functions">
            <div class="function-card">
                <h4>配置模块 (config.js)</h4>
                <ul>
                    <li>管理全局状态变量</li>
                    <li>定义常量配置</li>
                    <li>提供状态更新函数</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>工具模块 (utils.js)</h4>
                <ul>
                    <li><code>getActivityCategoryClass()</code> - 获取活动类别CSS类</li>
                    <li><code>getActivityClass()</code> - 获取活动CSS类</li>
                    <li><code>formatTime()</code> - 格式化时间显示</li>
                    <li><code>formatDuration()</code> - 格式化时长显示</li>
                    <li><code>getEmotionColor()</code> - 获取情绪颜色</li>
                    <li><code>parseDurationString()</code> - 解析时长字符串</li>
                    <li><code>calculateSegmentsTotalTime()</code> - 计算段落总时间</li>
                    <li><code>calculateRecordTotalTime()</code> - 计算记录总时间</li>
                    <li><code>toggleSection()</code> - 切换详情区域的折叠/展开状态</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>API模块 (api.js)</h4>
                <ul>
                    <li><code>loadActivityCategories()</code> - 加载活动类别配置</li>
                    <li><code>setUsername()</code> - 设置用户名</li>
                    <li><code>loadRecords()</code> - 加载记录</li>
                    <li><code>addRecord()</code> - 添加记录</li>
                    <li><code>updateRecord()</code> - 更新记录</li>
                    <li><code>deleteRecord()</code> - 删除记录</li>
                    <li><code>getRecord()</code> - 获取单个记录</li>
                    <li><code>getStats()</code> - 获取统计信息</li>
                    <li><code>loadAllRecords()</code> - 加载所有记录（带筛选和分页）</li>
                    <li><code>loadMoodWallData()</code> - 加载情绪墙数据</li>
                    <li><code>loadActivityWallData()</code> - 加载活动墙数据</li>
                    <li><code>loadDailyPlan()</code> - 加载今日计划</li>
                    <li><code>saveDailyPlan()</code> - 保存今日计划</li>
                    <li><code>syncDailyPlanToFeishu()</code> - 同步今日计划到飞书</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>UI模块 (ui.js)</h4>
                <ul>
                    <li><code>updateActivityButtons()</code> - 更新活动按钮显示</li>
                    <li><code>updateRecordsTable()</code> - 更新记录表格显示</li>
                    <li><code>showRecordDetail()</code> - 显示记录详情</li>
                    <li><code>saveRecordDetail()</code> - 保存记录详情</li>
                    <li><code>continueActivity()</code> - 继续活动</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>计时器模块 (timer.js)</h4>
                <ul>
                    <li><code>toggleTimer()</code> - 切换计时器状态</li>
                    <li><code>updateTimer()</code> - 更新计时器显示</li>
                    <li><code>resetTimer()</code> - 重置计时器</li>
                    <li><code>stopTimer()</code> - 停止计时</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>记录详情模块 (recordDetail.js)</h4>
                <ul>
                    <li><code>showRecordDetail()</code> - 显示记录详情</li>
                    <li><code>closeRecordDetailModal()</code> - 关闭记录详情浮窗</li>
                    <li><code>editRecordDetail()</code> - 编辑记录详情</li>
                    <li><code>saveRecordDetail()</code> - 保存记录详情</li>
                    <li><code>addSegment()</code> - 添加段落</li>
                    <li><code>deleteSegment()</code> - 删除段落</li>
                    <li><code>renumberSegments()</code> - 重新编号段落</li>
                    <li><code>toggleEmotion()</code> - 切换情绪选择</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>今日计划模块 (dailyPlan.js)</h4>
                <ul>
                    <li><code>init()</code> - 初始化今日计划模块</li>
                    <li><code>loadTodayPlan()</code> - 加载今日计划</li>
                    <li><code>loadDailyPlan()</code> - 加载指定日期计划</li>
                    <li><code>savePlan()</code> - 保存计划</li>
                    <li><code>startAutoSave()</code> - 开始自动保存</li>
                    <li><code>syncToFeishu()</code> - 同步到飞书</li>
                </ul>
            </div>
            
            <div class="function-card">
                <h4>主模块 (main.js)</h4>
                <ul>
                    <li>应用初始化</li>
                    <li>模块间协调</li>
                    <li>事件监听器绑定</li>
                </ul>
            </div>
        </div>
        
        <h3>API接口</h3>
        <div class="api-endpoints">
GET  /api/records          # 获取今日记录<br>
POST /api/records          # 添加新记录<br>
GET  /api/records/&lt;record_id&gt;  # 获取单个记录详情<br>
PUT  /api/records/&lt;record_id&gt;  # 更新记录<br>
DELETE /api/records/&lt;record_id&gt; # 删除记录<br>
GET  /api/all-records      # 获取所有记录（支持筛选和分页）<br>
GET  /api/stats            # 获取统计信息<br>
POST /api/set-username     # 设置用户名并迁移记录<br>
GET  /api/activity-categories # 获取活动类别配置<br>
GET  /api/mood-wall        # 获取情绪墙数据<br>
GET  /api/activity-wall    # 获取活动类型墙数据<br>
GET  /api/keyword-cloud    # 获取关键词词云数据<br>
GET  /api/daily-plan       # 获取今日计划<br>
POST /api/daily-plan       # 保存今日计划<br>
POST /api/daily-plan/sync-feishu # 同步今日计划到飞书<br>
GET  /api/feishu/config    # 获取飞书配置<br>
POST /api/feishu/config    # 保存飞书配置
        </div>
        
        <h3>项目结构</h3>
        <div class="code-block">
time_recoder/<br>
├── app.py              # Flask应用主文件<br>
├── requirements.txt    # 项目依赖<br>
├── README.md           # 项目说明文档<br>
├── PRD.md              # 产品需求文档<br>
├── structure.md        # 架构设计文档<br>
├── VERSIONS.md         # 版本更新记录 (当前版本: V1.2.15)<br>
├── data/               # 数据存储目录<br>
│   ├── records.json    # 所有用户记录文件<br>
│   ├── activity_categories.json # 活动类别配置文件<br>
│   └── daily_plans/    # 今日计划目录<br>
│       └── plans.json  # 今日计划索引文件<br>
├── templates/          # HTML模板目录<br>
│   ├── base.html       # 基础模板<br>
│   ├── index.html      # 主页面模板<br>
│   ├── records.html    # 记录页面模板<br>
│   ├── mood_wall.html  # 情绪墙页面模板<br>
│   ├── manage_categories.html # 类别管理页面模板<br>
│   └── project_description.html # 项目说明页面<br>
├── fix_records/        # 修复记录目录<br>
└── static/             # 静态文件目录<br>
    ├── css/<br>
    │   ├── style.css   # 样式文件<br>
    │   └── modules/    # CSS模块目录<br>
    │       ├── base.css              # 基础样式模块<br>
    │       ├── user-section.css      # 用户区域模块<br>
    │       ├── layout.css            # 布局模块<br>
    │       ├── activity-buttons.css  # 活动按钮模块<br>
    │       ├── activity-colors.css   # 活动颜色模块<br>
    │       ├── timer.css             # 计时器模块<br>
    │       ├── control-buttons.css   # 控制按钮模块<br>
    │       ├── detail-modal.css      # 详情模态框模块<br>
    │       ├── detail-form.css       # 详情表单模块<br>
    │       ├── navigation.css        # 导航模块<br>
    │       ├── records-table.css     # 记录表格模块<br>
    │       ├── stats.css             # 统计模块<br>
    │       ├── labels.css            # 标签模块<br>
    │       ├── manage-categories.css # 类别管理模块<br>
    │       ├── records-controls.css  # 记录控制模块<br>
    │       ├── pagination.css        # 分页模块<br>
    │       ├── segments.css          # 段落模块<br>
    │       ├── record-detail.css     # 记录详情模块<br>
    │       ├── selected-record.css   # 选中记录模块<br>
    │       ├── detail-sections.css   # 详情分段模块<br>
    │       ├── remark.css            # 收获记录模块<br>
    │       ├── activity-category.css # 活动类别模块<br>
    │       ├── start-time.css        # 开始时间模块<br>
    │       ├── emotion-tag.css       # 情绪标签模块<br>
    │       ├── mood-wall.css         # 情绪墙模块<br>
    │       ├── control-btn.css       # 控制按钮特殊样式<br>
    │       └── feishu-config.css     # 飞书配置模块<br>
    └── js/<br>
        ├── script.js   # JavaScript主文件（模块入口）<br>
        └── modules/    # JavaScript模块目录<br>
            ├── config.js       # 配置模块<br>
            ├── utils.js        # 工具模块<br>
            ├── api.js          # API模块<br>
            ├── ui.js           # UI模块<br>
            ├── timer.js        # 计时器模块<br>
            ├── recordDetail.js # 记录详情模块<br>
            ├── records.js      # 记录列表模块<br>
            ├── dailyPlan.js    # 今日计划模块<br>
            ├── feishuConfig.js # 飞书配置模块<br>
            └── main.js         # 主模块
        </div>
    </div>
    
    <div class="section">
        <h2>技术架构流程图</h2>
        <div class="mermaid">
            <pre class="mermaid">
flowchart TD
    A[用户界面] --> B[Flask后端]
    B --> C[JSON文件存储]
    C --> B
    B --> A
    D[API接口] --> B
    E[ES6模块化前端] --> A
    
    subgraph ES6模块化前端
        E1[配置模块] --> E
        E2[工具模块] --> E
        E3[API模块] --> E
        E4[UI模块] --> E
        E5[计时器模块] --> E
        E6[记录详情模块] --> E
        E7[记录列表模块] --> E
        E8[今日计划模块] --> E
        E9[飞书配置模块] --> E
        E10[主模块] --> E
    end
            </pre>
        </div>
    </div>
    
    <div class="section ai-coding">
        <h2>AI Coding方法建议</h2>
        
        <h3>开发流程优化</h3>
        <p>基于本项目的实践经验，推荐以下AI辅助开发流程：</p>
        
        <h4>1. 先计划，再执行，要验证，再总结结论</h4>
        <ul>
            <li><strong>查看PRD和架构文档</strong> - 开始任务前先了解产品需求和技术架构</li>
            <li><strong>调整PRD文档</strong> - 根据任务描述更新产品需求文档</li>
            <li><strong>设计测试思路</strong> - 提前规划测试用例和验证方法</li>
        </ul>
        
        <h4>2. 代码修改原则</h4>
        <ul>
            <li><strong>优先复用和优化</strong> - 优先复用和优化原接口和已有代码</li>
            <li><strong>合并重复功能</strong> - 发现有重复的功能代码，进行合并</li>
            <li><strong>保持可读性</strong> - 保持代码的可读性和可维护性</li>
            <li><strong>确保安全性</strong> - 确保代码修改不会引入新的bug</li>
            <li><strong>保持一致性</strong> - 保持代码的简洁性和一致性</li>
        </ul>
        
        <h4>3. 测试与验证</h4>
        <ul>
            <li><strong>设计测试用例</strong> - 为每个功能修改设计相应的测试用例</li>
            <li><strong>自动执行测试</strong> - 使用自动化测试验证功能正确性</li>
            <li><strong>删除测试用例</strong> - 测试完成后删除临时测试用例</li>
        </ul>
        
        <h3>项目维护最佳实践</h3>
        
        <h4>1. 文档同步更新</h4>
        <ul>
            <li><strong>更新技术架构</strong> - 创建和修改的数据流逻辑都更新在structure.md文件中</li>
            <li><strong>记录修复过程</strong> - 记录任务概况，写入fix_records/文件夹</li>
            <li><strong>版本信息维护</strong> - 更新VERSIONS.md文件记录项目更新</li>
        </ul>
        
        <h4>2. 代码质量保障</h4>
        <ul>
            <li><strong>模块化设计</strong> - 保持前端JavaScript和CSS的模块化设计</li>
            <li><strong>接口统一</strong> - 合并重复功能，统一API接口</li>
            <li><strong>错误处理</strong> - 增强错误处理和日志记录</li>
        </ul>
        
        <h4>3. 团队协作建议</h4>
        <ul>
            <li><strong>代码审查</strong> - 通过修复记录文档进行代码审查和知识传递</li>
            <li><strong>知识共享</strong> - 保持PRD和structure文档的实时更新</li>
            <li><strong>版本控制</strong> - 通过VERSIONS.md文件跟踪版本变更</li>
        </ul>
    </div>
    
    <div class="section future-plans">
        <h2>未来功能展望</h2>
        
        <div class="roadmap">
            <div class="phase short-term">
                <h4>短期计划（1-3个月）</h4>
                <ul>
                    <li>添加周/月/年统计视图</li>
                    <li>实现活动时间趋势分析</li>
                    <li>增加时间使用效率评估</li>
                    <li>添加活动时间目标设定</li>
                    <li>实现提醒功能</li>
                    <li>增加数据导出功能</li>
                </ul>
            </div>
            
            <div class="phase medium-term">
                <h4>中期计划（3-6个月）</h4>
                <ul>
                    <li>添加图表可视化</li>
                    <li>实现暗色主题</li>
                    <li>优化移动端体验</li>
                    <li>添加好友系统</li>
                    <li>实现时间使用排行榜</li>
                    <li>增加活动分享功能</li>
                </ul>
            </div>
            
            <div class="phase long-term">
                <h4>长期计划（6个月以上）</h4>
                <ul>
                    <li>集成AI助手提供时间管理建议</li>
                    <li>实现自然语言记录</li>
                    <li>添加智能情绪分析</li>
                    <li>实现团队时间追踪</li>
                    <li>开发插件系统</li>
                    <li>创建开发者API</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
</script>
{% endblock %}