{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/user-section.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/daily-plan-original.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/feishu-config.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/detail-modal.css') }}">
<style>
/* 计时器样式 */
.focus-timer-section {
    text-align: center;
    padding: 25px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    margin: 20px 0;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    position: relative;
    overflow: hidden;
    transform: scale(1);
    transition: all 0.3s ease;
    /* 确保计时器区域不会遮盖其他元素 */
    z-index: 1;
    /* 使计时器区域可点击 */
    cursor: pointer;
    user-select: none;
}

.focus-timer-section:hover {
    transform: scale(1.02);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.focus-timer-section::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #4CAF50, #2196F3, #9C27B0, #FF9800);
    animation: progressAnimation 3s linear infinite;
}

@keyframes progressAnimation {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.focus-label {
    color: rgba(255, 255, 255, 0.9);
    font-size: 18px;
    font-weight: 500;
    margin-bottom: 10px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.focus-timer-section .timer-display {
    font-size: 60px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    margin: 10px 0;
    font-weight: 600;
    font-family: 'Roboto Mono', 'Courier New', monospace;
    letter-spacing: 2px;
    animation: timerPulse 2s infinite;
}

@keyframes timerPulse {
    0% { opacity: 1; }
    50% { opacity: 0.9; }
    100% { opacity: 1; }
}

/* 计时器运行时的样式 */
.focus-timer-section.running {
    background: linear-gradient(135deg, #ff9800 0%, #EF6C00 100%);
    box-shadow: 0 8px 25px rgba(255, 152, 0, 0.4);
}

.focus-timer-section.running .focus-label::after {
    content: " (点击停止)";
    font-size: 14px;
}

.focus-timer-section:not(.running) .focus-label::after {
    content: " (点击开始)";
    font-size: 14px;
}

/* 当前活动区域样式 */
.current-activity {
    text-align: center;
    font-size: 30px;
    color: #444;
    margin-bottom: 20px;
    font-weight: 500;
    padding: 15px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 8px;
    border-left: 4px solid #2196F3;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
    /* 确保当前活动区域不会遮盖其他元素 */
    z-index: 1;
    position: relative;
    /* 使当前活动区域可点击 */
    cursor: pointer;
    user-select: none;
    /* 支持编辑状态 */
    outline: none;
    /* 始终居中显示 */
    display: flex;
    align-items: center;
    justify-content: center;
}

.current-activity:hover {
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

/* 当前活动区域编辑时的样式 */
.current-activity.editing {
    border-left: 4px solid #4CAF50;
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
}

/* 工作输出类 - 蓝色系 */
.focus-timer-section.btn-work-output {
    background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
}

/* 大脑&身体充电类 - 绿色系 */
.focus-timer-section.btn-charge {
    background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
}

/* 修养生息类 - 紫色系 */
.focus-timer-section.btn-rest {
    background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
}

/* 输出创作类 - 橙色系 */
.focus-timer-section.btn-create {
    background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
}

/* 暂停一下类 - 青色系 */
.focus-timer-section.btn-gap {
    background: linear-gradient(135deg, #00BCD4 0%, #0097A7 100%);
}

/* 纯属娱乐类 - 灰色系 */
.focus-timer-section.btn-entertainment {
    background: linear-gradient(135deg, #607D8B 0%, #455A64 100%);
}

/* 快速记录区域容器 - 两栏布局 */
.quick-record-container {
    display: flex;
    gap: 20px;
    margin-top: 15px;
}

.quick-record-column {
    flex: 1;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
}

.quick-record-column.hidden {
    display: none;
}

.quick-record-label {
    font-size: 14px;
    color: #555;
    margin-bottom: 10px;
    font-weight: 500;
}

/* 快速情绪记录区域 */
.quick-emotion-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    flex: 1;
    align-content: flex-start;
}

.emotion-btn {
    width: 50px; /* 增大按钮宽度 */
    height: 50px; /* 增大按钮高度 */
    border-radius: 50%;
    border: none;
    cursor: pointer;
    font-size: 20px; /* 增大字体 */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
}

.emotion-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.emotion-btn:active {
    transform: scale(0.95);
}

/* 选中的情绪按钮样式 */
.emotion-btn.selected {
    box-shadow: 0 0 0 3px white, 0 0 0 6px currentColor;
    transform: scale(1.1);
}

/* 情绪按钮中的图标和文字样式 */
.emotion-btn .emotion-icon {
    font-size: 20px; /* 增大图标字体 */
    display: flex;
    align-items: center;
    justify-content: center;
}

.emotion-btn .emotion-text {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 12px;
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s ease;
    pointer-events: none;
}

.emotion-btn:hover .emotion-text {
    opacity: 1;
}

/* 情绪选中标记 */
.emotion-checkmark {
    position: absolute;
    top: 0;
    right: 0;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    font-size: 12px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

/* 快速记录收获区域 */
.quick-remark-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    resize: vertical;
    min-height: 100px;
    flex: 1;
}

/* 移动端优化 */
@media (max-width: 768px) {
    .quick-record-container {
        flex-direction: column;
    }
    
    .current-activity {
        font-size: 30px;
        padding: 12px;
        margin-bottom: 15px;
    }
    
    .quick-emotion-buttons {
        gap: 6px;
    }
    
    .emotion-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
}
</style>
{% endblock %}

{% block content %}
<h1>时间追踪器</h1>

<!-- 今日计划区域 -->
<div class="daily-plan-section">
    <div class="daily-plan-header">
        <h2 class="daily-plan-title">
            📝 今日计划
            <span class="daily-plan-date">今天是——</span>
        </h2>
        <button id="plan-toggle-btn" class="daily-plan-toggle">展开</button>
    </div>
    
    <!-- 折叠时显示的简要视图 -->
    <div class="daily-plan-summary" id="daily-plan-summary" style="display: block;">
        <div class="summary-section">
            <div class="summary-title">🎯 今天重要的三件事：</div>
            <ol class="summary-list" id="summary-important-things">
                <li class="summary-item-empty">还未填写</li>
            </ol>
        </div>
        
        <div class="summary-section">
            <div class="summary-title">✨ 今天要尝试的三件事：</div>
            <ol class="summary-list" id="summary-try-things">
                <li class="summary-item-empty">还未填写</li>
            </ol>
        </div>
        
        <div class="summary-section">
            <div class="summary-title">😊 今日的情绪集合：</div>
            <div class="summary-emotions" id="summary-emotions">
                <span class="summary-item-empty">还未记录</span>
            </div>
        </div>
        
        <div class="summary-section">
            <div class="summary-title">🎯 今日的活动类型集合：</div>
            <div class="summary-categories" id="summary-categories">
                <span class="summary-item-empty">还未记录</span>
            </div>
        </div>
    </div>
    
    <!-- 新增：今日统计数据（全宽显示） -->
    <div class="daily-plan-stats-full-width" id="daily-plan-stats-full-width" style="display: block; margin-top: 15px;">
        <div class="daily-plan-stats-content">
            <div class="daily-plan-stats-title">📊 今日统计</div>
            <div class="summary-stats">
                <div class="summary-stat-item">
                    <div class="stat-label">专注时长</div>
                    <div class="stat-value" id="summary-total-duration">0小时0分</div>
                </div>
                <div class="summary-stat-item">
                    <div class="stat-label">创作时长</div>
                    <div class="stat-value" id="summary-creation-duration">0小时0分</div>
                </div>
                <div class="summary-stat-item">
                    <div class="stat-label">活动次数</div>
                    <div class="stat-value" id="summary-activity-count">0次</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="daily-plan-content" style="display: none;">
        <!-- 重要的三件事 -->
        <div class="plan-group">
            <div class="plan-group-title">🎯 今天重要的三件事</div>
            <input type="text" class="plan-input" id="important-1" placeholder="重要事项 1">
            <input type="text" class="plan-input" id="important-2" placeholder="重要事项 2">
            <input type="text" class="plan-input" id="important-3" placeholder="重要事项 3">
        </div>
        
        <!-- 要尝试的三件事 -->
        <div class="plan-group">
            <div class="plan-group-title">✨ 今天要尝试的三件事</div>
            <input type="text" class="plan-input" id="try-1" placeholder="尝试事项 1">
            <input type="text" class="plan-input" id="try-2" placeholder="尝试事项 2">
            <input type="text" class="plan-input" id="try-3" placeholder="尝试事项 3">
        </div>
        
        <!-- 其他事项 -->
        <div class="plan-group">
            <div class="plan-group-title">📝 其他事项</div>
            <textarea class="plan-textarea" id="other-matters" placeholder="其他需要处理的事项..."></textarea>
        </div>
        
        <!-- 今日充电 -->
        <div class="plan-group">
            <div class="plan-group-title">📖 今日充电（要阅读）</div>
            <textarea class="plan-textarea" id="reading" placeholder="今天计划阅读的内容..."></textarea>
        </div>
        
        <!-- 给今天打个分 -->
        <div class="plan-group">
            <div class="plan-group-title">⭐ 给今天打个分</div>
            <div class="score-options">
                <button class="score-option" data-score="优秀">🌟 优秀</button>
                <button class="score-option" data-score="良好">😊 良好</button>
                <button class="score-option" data-score="一般">😐 一般</button>
                <button class="score-option" data-score="较差">😔 较差</button>
                <button class="score-option" data-score="很差">😢 很差</button>
            </div>
        </div>
        
        <!-- 为什么？ -->
        <div class="plan-group">
            <div class="plan-group-title">🤔 为什么？</div>
            <textarea class="plan-textarea" id="score-reason" placeholder="为什么这样打分？"></textarea>
        </div>
        
        <!-- 自动更新区域 -->
        <div class="auto-update-section">
            <div class="auto-update-title">📊 今日统计（自动更新）</div>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">专注时长</div>
                    <div class="stat-value" id="plan-total-duration">0小时0分</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">创作时长</div>
                    <div class="stat-value" id="plan-creation-duration">0小时0分</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">活动次数</div>
                    <div class="stat-value" id="plan-activity-count">0</div>
                </div>
            </div>
            
            <div class="plan-group-title" style="margin-top: 15px;">🎯 今日做过的活动</div>
            <div class="activities-list" id="plan-activities-list">
                <div style="text-align:center; padding:20px; opacity:0.7;">暂无活动记录</div>
            </div>
            
            <div class="plan-group-title" style="margin-top: 15px;">😊 今日的情绪集合</div>
            <div class="emotions-grid" id="plan-emotions-grid">
                <div style="opacity:0.7;">暂无情绪记录</div>
            </div>
        </div>
    </div>
    
    <div class="daily-plan-actions">
        <!-- 同步到飞书按钮已移除，同步操作已集成到自动保存和收起功能中 -->
    </div>
    
    <div id="sync-status" class="sync-status not-synced">
        <span class="not-synced">✗ 未同步到飞书</span>
    </div>
</div>

<div class="main-layout">
    <div class="section" style="grid-column: 1 / -1;">
        <div class="current-activity" id="currentActivity" contenteditable="false">请选择活动</div>
        
        <!-- 合并计时器和开始按钮 -->
        <div class="focus-timer-section" id="focusTimerSection">
            <div class="focus-label">当前持续专注时长</div>
            <div class="timer-display" id="timerDisplay">00:00:00</div>
        </div>
        
        <!-- 快速记录区域容器 -->
        <div class="quick-record-container" id="quickRecordContainer" style="display: none;">
            <!-- 快速情绪记录区域 -->
            <div class="quick-record-column" id="quickEmotionColumn">
                <div class="quick-record-label">快速记录情绪：</div>
                <div class="quick-emotion-buttons">
                    <!-- 正向+专注：惊奇、兴奋、高兴、愉悦 -->
                    <button class="emotion-btn" data-emotion="惊奇" style="background-color: #9C27B0;" title="惊奇">
                        <span class="emotion-icon">✨</span>
                        <span class="emotion-text">惊奇</span>
                    </button>
                    <button class="emotion-btn" data-emotion="兴奋" style="background-color: #E91E63;" title="兴奋">
                        <span class="emotion-icon">🤩</span>
                        <span class="emotion-text">兴奋</span>
                    </button>
                    <button class="emotion-btn" data-emotion="高兴" style="background-color: #4CAF50;" title="高兴">
                        <span class="emotion-icon">😊</span>
                        <span class="emotion-text">高兴</span>
                    </button>
                    <button class="emotion-btn" data-emotion="愉悦" style="background-color: #8BC34A;" title="愉悦">
                        <span class="emotion-icon">😄</span>
                        <span class="emotion-text">愉悦</span>
                    </button>
                    
                    <!-- 正向+松弛：安逸、安心、满足、宁静、放松 -->
                    <button class="emotion-btn" data-emotion="安逸" style="background-color: #00BCD4;" title="安逸">
                        <span class="emotion-icon">🪂</span>
                        <span class="emotion-text">安逸</span>
                    </button>
                    <button class="emotion-btn" data-emotion="安心" style="background-color: #2196F3;" title="安心">
                        <span class="emotion-icon">😌</span>
                        <span class="emotion-text">安心</span>
                    </button>
                    <button class="emotion-btn" data-emotion="满足" style="background-color: #8BC34A;" title="满足">
                        <span class="emotion-icon">😋</span>
                        <span class="emotion-text">满足</span>
                    </button>
                    <button class="emotion-btn" data-emotion="宁静" style="background-color: #009688;" title="宁静">
                        <span class="emotion-icon">🧘</span>
                        <span class="emotion-text">宁静</span>
                    </button>
                    <button class="emotion-btn" data-emotion="放松" style="background-color: #CDDC39;" title="放松">
                        <span class="emotion-icon">🌿</span>
                        <span class="emotion-text">放松</span>
                    </button>
                    
                    <!-- 负面+松弛：悲伤、伤心、沮丧、疲惫 -->
                    <button class="emotion-btn" data-emotion="悲伤" style="background-color: #546E7A;" title="悲伤">
                        <span class="emotion-icon">😢</span>
                        <span class="emotion-text">悲伤</span>
                    </button>
                    <button class="emotion-btn" data-emotion="伤心" style="background-color: #78909C;" title="伤心">
                        <span class="emotion-icon">💔</span>
                        <span class="emotion-text">伤心</span>
                    </button>
                    <button class="emotion-btn" data-emotion="沮丧" style="background-color: #5D4037;" title="沮丧">
                        <span class="emotion-icon">😞</span>
                        <span class="emotion-text">沮丧</span>
                    </button>
                    <button class="emotion-btn" data-emotion="疲惫" style="background-color: #4E342E;" title="疲惫">
                        <span class="emotion-icon">😴</span>
                        <span class="emotion-text">疲惫</span>
                    </button>
                    
                    <!-- 负面+专注：惊恐、紧张、愤怒、苦恼 -->
                    <button class="emotion-btn" data-emotion="惊恐" style="background-color: #424242;" title="惊恐">
                        <span class="emotion-icon">😱</span>
                        <span class="emotion-text">惊恐</span>
                    </button>
                    <button class="emotion-btn" data-emotion="紧张" style="background-color: #616161;" title="紧张">
                        <span class="emotion-icon">😰</span>
                        <span class="emotion-text">紧张</span>
                    </button>
                    <button class="emotion-btn" data-emotion="愤怒" style="background-color: #BF360C;" title="愤怒">
                        <span class="emotion-icon">😡</span>
                        <span class="emotion-text">愤怒</span>
                    </button>
                    <button class="emotion-btn" data-emotion="苦恼" style="background-color: #FF6F00;" title="苦恼">
                        <span class="emotion-icon">😫</span>
                        <span class="emotion-text">苦恼</span>
                    </button>
                </div>
            </div>
            
            <!-- 快速记录收获区域 -->
            <div class="quick-record-column" id="quickRemarkColumn">
                <div class="quick-record-label">快速记录收获：</div>
                <textarea class="quick-remark-input" id="quickRemarkInput" placeholder="记录下此刻的收获或想法..."></textarea>
            </div>
        </div>
        
        <!-- 移除原来的控制按钮 -->
        <!-- <div class="control-buttons">
            <button class="control-btn toggle-btn" id="toggleBtn">开始专注吧！</button>
        </div> -->
    </div>
    
    <div class="section" style="grid-column: 1 / -1;">
        <h2>今日记录详情（<span id="currentDate"></span>）</h2>
        <table class="records-table">
            <thead>
                <tr>
                    <th>活动</th>
                    <th>开始时间</th>
                    <th>计时时长</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="recordsBody">
            </tbody>
        </table>
    </div>
</div>

<!-- 活动详情浮窗 -->
<div id="recordDetailModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="TimeRecorderRecordDetail.closeRecordDetailModal()">&times;</span>
        <h2>活动详情</h2>
        <div id="recordDetailContent"></div>
    </div>
</div>

<script>
</script>
{% endblock %}